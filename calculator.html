<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Engineering Calculators</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React and ReactDOM CDNs -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <!-- Framer Motion CDN -->
  <script src="https://unpkg.com/framer-motion@11.3.2/dist/framer-motion.min.js"></script>
  <!-- Babel Standalone CDN for JSX -->
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  <style>
    body {
        font-family: 'Inter', sans-serif;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useMemo } = React;

    // Check for the FramerMotion object to prevent errors if it hasn't loaded yet.
    const FramerMotion = window.FramerMotion;
    const motion = FramerMotion ? FramerMotion.motion : null;
    const AnimatePresence = FramerMotion ? FramerMotion.AnimatePresence : null;

    // --- Calculator Data (Hard-coded for now) ---
    const conduitData = [
      { size: "1/2\"", area: 0.304 }, { size: "3/4\"", area: 0.533 },
      { size: "1\"", area: 0.864 }, { size: "1 1/4\"", area: 1.503 },
      { size: "1 1/2\"", area: 2.031 }, { size: "2\"", area: 3.356 },
      { size: "2 1/2\"", area: 4.786 }, { size: "3\"", area: 7.388 },
      { size: "3 1/2\"", area: 9.89 }, { size: "4\"", area: 12.63 }
    ];

    const wireData = [
      // THHN
      { gauge: "14 AWG", area: 0.0134, insulation: "THHN" },
      { gauge: "12 AWG", area: 0.0177, insulation: "THHN" },
      { gauge: "10 AWG", area: 0.0222, insulation: "THHN" },
      // THW
      { gauge: "14 AWG", area: 0.0195, insulation: "THW" },
      { gauge: "12 AWG", area: 0.0236, insulation: "THW" },
      { gauge: "10 AWG", area: 0.0305, insulation: "THW" },
      // XHHW
      { gauge: "14 AWG", area: 0.0181, insulation: "XHHW" },
      { gauge: "12 AWG", area: 0.0211, insulation: "XHHW" },
      { gauge: "10 AWG", area: 0.0270, insulation: "XHHW" },
    ];
    
    const conduitTypes = {
        'emt': 'Electrical Metallic Tubing (EMT)',
        'rmc': 'Rigid Metal Conduit (RMC)',
        'pvc': 'PVC Conduit'
    };
    
    // Function to determine the max fill percentage based on NEC rules
    const getMaxFillPercentage = (wireCount) => {
        if (wireCount <= 0 || isNaN(wireCount)) return 0;
        if (wireCount === 1) return 0.53;
        if (wireCount === 2) return 0.31;
        return 0.40;
    };

    // --- Components for each Calculator ---
    const ConduitFillCalculator = () => {
      const uniqueGauges = useMemo(() => [...new Set(wireData.map(w => w.gauge))], []);
      const uniqueInsulations = useMemo(() => [...new Set(wireData.map(w => w.insulation))], []);

      const [selectedConduitSize, setSelectedConduitSize] = useState(conduitData[0].size);
      const [selectedConduitType, setSelectedConduitType] = useState('emt');
      const [wireCount, setWireCount] = useState(3);
      const [selectedWireGauge, setSelectedWireGauge] = useState(uniqueGauges[0]);
      const [selectedInsulation, setSelectedInsulation] = useState(uniqueInsulations[0]);
      // Initialize ground wire state to an empty string for the "None" option
      const [selectedGroundWireGauge, setSelectedGroundWireGauge] = useState('');
      const [selectedGroundWireInsulation, setSelectedGroundWireInsulation] = useState('');

      const {
        conduitArea,
        wireArea,
        groundWireArea,
        totalWireArea,
        maxFillPercentage,
        currentFillPercentage,
        isCompliant,
        message
      } = useMemo(() => {
        const conduit = conduitData.find(c => c.size === selectedConduitSize);
        const wire = wireData.find(w => w.gauge === selectedWireGauge && w.insulation === selectedInsulation);
        
        // Find ground wire data only if a ground wire gauge and insulation type are selected
        const groundWire = (selectedGroundWireGauge && selectedGroundWireInsulation)
          ? wireData.find(w => w.gauge === selectedGroundWireGauge && w.insulation === selectedGroundWireInsulation)
          : null;
        
        const conduitArea = (conduit && conduit.area) || 0;
        const wireArea = (wire && wire.area) || 0;
        // Ground wire area is 0 if no wire or insulation is selected
        const groundWireArea = (groundWire && groundWire.area) || 0;

        const totalWireArea = (wireArea * wireCount) + groundWireArea;
        
        // Calculate total wire count, including the ground wire only if one is selected
        const totalWireCount = parseInt(wireCount) + (selectedGroundWireGauge && selectedGroundWireInsulation ? 1 : 0);
        const maxFillPercentage = getMaxFillPercentage(totalWireCount);
        const maxFillArea = conduitArea * maxFillPercentage;

        const currentFillPercentage = conduitArea > 0 ? (totalWireArea / conduitArea) * 100 : 0;

        const isCompliant = totalWireArea <= maxFillArea;

        let message = '';
        const parsedWireCount = parseInt(wireCount);

        if (isNaN(parsedWireCount) || parsedWireCount < 0) {
            message = 'Please enter a valid number of wires.';
        } else if (currentFillPercentage > (maxFillPercentage * 100)) {
            message = 'This configuration exceeds the maximum allowable fill percentage!';
        } else {
            message = 'This configuration is compliant with NEC guidelines.';
        }

        return {
          conduitArea: conduitArea,
          wireArea: wireArea,
          groundWireArea: groundWireArea,
          totalWireArea: totalWireArea,
          maxFillPercentage: maxFillPercentage,
          maxFillArea: maxFillArea,
          currentFillPercentage: currentFillPercentage,
          isCompliant: isCompliant,
          message: message
        };
      }, [selectedConduitSize, wireCount, selectedWireGauge, selectedInsulation, selectedGroundWireGauge, selectedGroundWireInsulation]);

      const handleWireCountChange = (e) => {
        const value = e.target.value;
        if (value === '' || (!isNaN(value) && value >= 0)) {
          setWireCount(value);
        }
      };

      const inputStyle = "w-full p-3 border-2 border-slate-200 rounded-lg text-slate-800 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200 shadow-sm";
      const resultCardStyle = isCompliant ? "bg-emerald-50 text-emerald-800 border-emerald-300" : "bg-rose-50 text-rose-800 border-rose-300";

      return (
        <div>
          <div className="flex items-center space-x-4 mb-8">
            <img src="https://placehold.co/40x40/f7941d/ffffff?text=Cat" alt="A cat image" className="rounded-full w-10 h-10 object-cover border-2 border-slate-200 shadow-sm" />
            <h1 className="text-4xl font-bold text-slate-900">Conduit Fill Calculator</h1>
          </div>
          <p className="text-slate-600 mb-8">
            Calculate the fill percentage of a conduit based on the number and size of the cables.
            This tool uses standard NEC fill percentages (53% for one wire, 31% for two, 40% for three or more).
          </p>

          <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <div>
              <label htmlFor="conduit-size" className="block text-sm font-medium text-slate-700 mb-2">
                <span className="inline-block mr-2 w-4 h-4 text-blue-500">üìè</span>
                Conduit Trade Size
              </label>
              <select id="conduit-size" value={selectedConduitSize} onChange={(e) => setSelectedConduitSize(e.target.value)} className={inputStyle}>
                {conduitData.map((c, index) => (<option key={index} value={c.size}>{c.size}</option>))}
              </select>
            </div>
            <div>
              <label htmlFor="conduit-type" className="block text-sm font-medium text-slate-700 mb-2">
                <span className="inline-block mr-2 w-4 h-4 text-blue-500">üì¶</span>
                Conduit Type
              </label>
              <select id="conduit-type" value={selectedConduitType} onChange={(e) => setSelectedConduitType(e.target.value)} className={inputStyle}>
                {Object.entries(conduitTypes).map(([key, value]) => (<option key={key} value={key}>{value}</option>))}
              </select>
            </div>
            <div className="md:col-span-2 grid grid-cols-1 md:grid-cols-3 gap-6">
              <div>
                <label htmlFor="wire-count" className="block text-sm font-medium text-slate-700 mb-2">
                  <span className="inline-block mr-2 w-4 h-4 text-blue-500">üîå</span>
                  Number of Wires (Hot/Neutral)
                </label>
                <input id="wire-count" type="number" value={wireCount} onChange={handleWireCountChange} min="0" className={inputStyle} placeholder="e.g., 3" />
              </div>
              <div>
                <label htmlFor="insulation-type" className="block text-sm font-medium text-slate-700 mb-2">
                  <span className="inline-block mr-2 w-4 h-4 text-blue-500">üìä</span>
                  Wire Insulation Type
                </label>
                <select id="insulation-type" value={selectedInsulation} onChange={(e) => setSelectedInsulation(e.target.value)} className={inputStyle}>
                  {uniqueInsulations.map((insulation, index) => (<option key={index} value={insulation}>{insulation}</option>))}
                </select>
              </div>
              <div>
                <label htmlFor="wire-gauge" className="block text-sm font-medium text-slate-700 mb-2">
                  <span className="inline-block mr-2 w-4 h-4 text-blue-500">üìä</span>
                  Wire Gauge
                </label>
                <select id="wire-gauge" value={selectedWireGauge} onChange={(e) => setSelectedWireGauge(e.target.value)} className={inputStyle}>
                  {uniqueGauges.map((gauge, index) => (<option key={index} value={gauge}>{gauge}</option>))}
                </select>
              </div>
            </div>
            <div className="md:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <label htmlFor="ground-insulation-type" className="block text-sm font-medium text-slate-700 mb-2">
                  <span className="inline-block mr-2 w-4 h-4 text-blue-500">‚ö°</span>
                  Ground Wire Insulation Type
                </label>
                <select id="ground-insulation-type" value={selectedGroundWireInsulation} onChange={(e) => setSelectedGroundWireInsulation(e.target.value)} className={inputStyle}>
                  <option value="">None</option>
                  {uniqueInsulations.map((insulation, index) => (<option key={index} value={insulation}>{insulation}</option>))}
                </select>
              </div>
              <div>
                <label htmlFor="ground-wire-gauge" className="block text-sm font-medium text-slate-700 mb-2">
                  <span className="inline-block mr-2 w-4 h-4 text-blue-500">‚ö°</span>
                  Ground Wire Gauge
                </label>
                <select id="ground-wire-gauge" value={selectedGroundWireGauge} onChange={(e) => setSelectedGroundWireGauge(e.target.value)} className={inputStyle}>
                  <option value="">None</option>
                  {uniqueGauges.map((gauge, index) => (<option key={index} value={gauge}>{gauge}</option>))}
                </select>
              </div>
            </div>
          </div>
          {/* Conditional rendering for ResultCard to avoid errors if Framer Motion isn't ready */}
          {AnimatePresence && motion ? (
            <AnimatePresence mode="wait">
              {wireCount >= 0 && (
                <motion.div
                  key="result"
                  initial={{ opacity: 0, y: 20 }}
                  animate={{ opacity: 1, y: 0 }}
                  exit={{ opacity: 0, y: -20 }}
                  transition={{ duration: 0.3 }}
                  className={`border-l-4 rounded-r-lg p-6 mb-6 transition-colors duration-300 ${resultCardStyle}`}
                >
                  <div className="flex items-center space-x-3 mb-4">
                    {isCompliant ? <span className="h-6 w-6 text-emerald-600">‚úÖ</span> : <span className="h-6 w-6 text-rose-600">‚ö†Ô∏è</span>}
                    <h2 className="text-xl font-bold">{message}</h2>
                  </div>
                  <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 text-sm font-medium">
                    <div className="flex flex-col">
                      <span className="text-slate-500">Conduit Area:</span>
                      <span className="text-lg">{conduitArea.toFixed(3)} in¬≤</span>
                    </div>
                    <div className="flex flex-col">
                      <span className="text-slate-500">Max Fill Area:</span>
                      <span className="text-lg">{(maxFillPercentage * conduitArea).toFixed(3)} in¬≤</span>
                    </div>
                    <div className="flex flex-col">
                      <span className="text-slate-500">Total Wires Area:</span>
                      <span className="text-lg">{(totalWireArea).toFixed(3)} in¬≤</span>
                    </div>
                    <div className="flex flex-col">
                      <span className="text-slate-500">Fill Percentage:</span>
                      <span className="text-lg flex items-center">
                        <span className="w-4 h-4 mr-1">üìà</span>
                        {currentFillPercentage.toFixed(2)}%
                      </span>
                    </div>
                  </div>
                </motion.div>
              )}
            </AnimatePresence>
          ) : (
            // Fallback for when Framer Motion is not available
            wireCount >= 0 && (
              <div className={`border-l-4 rounded-r-lg p-6 mb-6 transition-colors duration-300 ${resultCardStyle}`}>
                <div className="flex items-center space-x-3 mb-4">
                  {isCompliant ? <span className="h-6 w-6 text-emerald-600">‚úÖ</span> : <span className="h-6 w-6 text-rose-600">‚ö†Ô∏è</span>}
                  <h2 className="text-xl font-bold">{message}</h2>
                </div>
                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 text-sm font-medium">
                  <div className="flex flex-col">
                    <span className="text-slate-500">Conduit Area:</span>
                    <span className="text-lg">{conduitArea.toFixed(3)} in¬≤</span>
                  </div>
                  <div className="flex flex-col">
                    <span className="text-slate-500">Max Fill Area:</span>
                    <span className="text-lg">{(maxFillPercentage * conduitArea).toFixed(3)} in¬≤</span>
                  </div>
                  <div className="flex flex-col">
                    <span className="text-slate-500">Total Wires Area:</span>
                    <span className="text-lg">{(totalWireArea).toFixed(3)} in¬≤</span>
                  </div>
                  <div className="flex flex-col">
                    <span className="text-slate-500">Fill Percentage:</span>
                    <span className="text-lg flex items-center">
                        <span className="w-4 h-4 mr-1">üìà</span>
                        {currentFillPercentage.toFixed(2)}%
                    </span>
                  </div>
                </div>
              </div>
            )
          )}
        </div>
      );
    };

    const LoadFlowCalculator = () => (
      <div>
        <h1 className="text-4xl font-bold text-slate-900 mb-4">Load Flow Calculator</h1>
        <p className="text-slate-600 mb-8">
          This is a placeholder for the Load Flow Calculator.
          You can add the input fields and calculation logic for your specific needs here.
        </p>
        <div className="bg-slate-200 p-8 rounded-lg text-slate-500 text-center">
          <p>This section is ready for your load flow inputs and results!</p>
        </div>
      </div>
    );

    const ThermalAmpacityCalculator = () => (
      <div>
        <h1 className="text-4xl font-bold text-slate-900 mb-4">Thermal Ampacity Calculator</h1>
        <p className="text-slate-600 mb-8">
          This is a placeholder for the Thermal Ampacity Calculator.
          Add your specific thermal calculations and results here.
        </p>
        <div className="bg-slate-200 p-8 rounded-lg text-slate-500 text-center">
          <p>This section is ready for your ampacity inputs and results!</p>
        </div>
      </div>
    );

    const App = () => {
      const [activeCalculator, setActiveCalculator] = useState('conduit');

      const renderCalculator = () => {
        switch (activeCalculator) {
          case 'conduit':
            return <ConduitFillCalculator />;
          case 'loadFlow':
            return <LoadFlowCalculator />;
          case 'ampacity':
            return <ThermalAmpacityCalculator />;
          default:
            return <ConduitFillCalculator />;
        }
      };

      // Conditionally render the entire app based on whether motion is available.
      if (motion) {
        return (
          <div className="min-h-screen bg-slate-100 p-4 font-sans antialiased text-slate-800">
            <div className="max-w-4xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
              <motion.div
                initial={{ opacity: 0, y: -20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ duration: 0.5 }}
                className="bg-white rounded-2xl shadow-xl p-8"
              >
                <div className="flex justify-center border-b border-slate-200 mb-8">
                  <motion.button
                    whileHover={{ scale: 1.05 }}
                    whileTap={{ scale: 0.95 }}
                    onClick={() => setActiveCalculator('conduit')}
                    className={`py-3 px-6 text-lg font-medium transition-colors duration-300 ${activeCalculator === 'conduit' ? 'text-blue-600 border-b-2 border-blue-600' : 'text-slate-500 hover:text-blue-600'}`}
                  >
                    Conduit Fill
                  </motion.button>
                  <motion.button
                    whileHover={{ scale: 1.05 }}
                    whileTap={{ scale: 0.95 }}
                    onClick={() => setActiveCalculator('loadFlow')}
                    className={`py-3 px-6 text-lg font-medium transition-colors duration-300 ${activeCalculator === 'loadFlow' ? 'text-blue-600 border-b-2 border-blue-600' : 'text-slate-500 hover:text-blue-600'}`}
                  >
                    Load Flow
                  </motion.button>
                  <motion.button
                    whileHover={{ scale: 1.05 }}
                    whileTap={{ scale: 0.95 }}
                    onClick={() => setActiveCalculator('ampacity')}
                    className={`py-3 px-6 text-lg font-medium transition-colors duration-300 ${activeCalculator === 'ampacity' ? 'text-blue-600 border-b-2 border-blue-600' : 'text-slate-500 hover:text-blue-600'}`}
                  >
                    Thermal Ampacity
                  </motion.button>
                </div>
                <AnimatePresence mode="wait">
                  <motion.div
                    key={activeCalculator}
                    initial={{ opacity: 0, y: 10 }}
                    animate={{ opacity: 1, y: 0 }}
                    exit={{ opacity: 0, y: -10 }}
                    transition={{ duration: 0.2 }}
                  >
                    {renderCalculator()}
                  </motion.div>
                </AnimatePresence>
              </motion.div>
            </div>
          </div>
        );
      } else {
        // Fallback for when Framer Motion is not available
        return (
          <div className="min-h-screen bg-slate-100 p-4 font-sans antialiased text-slate-800">
            <div className="max-w-4xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
              <div className="bg-white rounded-2xl shadow-xl p-8">
                <div className="flex justify-center border-b border-slate-200 mb-8">
                  <button onClick={() => setActiveCalculator('conduit')} className={`py-3 px-6 text-lg font-medium transition-colors duration-300 ${activeCalculator === 'conduit' ? 'text-blue-600 border-b-2 border-blue-600' : 'text-slate-500 hover:text-blue-600'}`}>Conduit Fill</button>
                  <button onClick={() => setActiveCalculator('loadFlow')} className={`py-3 px-6 text-lg font-medium transition-colors duration-300 ${activeCalculator === 'loadFlow' ? 'text-blue-600 border-b-2 border-blue-600' : 'text-slate-500 hover:text-blue-600'}`}>Load Flow</button>
                  <button onClick={() => setActiveCalculator('ampacity')} className={`py-3 px-6 text-lg font-medium transition-colors duration-300 ${activeCalculator === 'ampacity' ? 'text-blue-600 border-b-2 border-blue-600' : 'text-slate-500 hover:text-blue-600'}`}>Thermal Ampacity</button>
                </div>
                <div>{renderCalculator()}</div>
              </div>
            </div>
          </div>
        );
      }
    };
    
    // Renders the app when the window has finished loading.
    const renderApp = () => {
        const rootElement = document.getElementById('root');
        if (rootElement) {
            ReactDOM.createRoot(rootElement).render(<App />);
        }
    };
    window.addEventListener('load', renderApp);
  </script>
</body>
</html>
